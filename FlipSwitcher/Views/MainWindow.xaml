<Window x:Class="FlipSwitcher.Views.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vm="clr-namespace:FlipSwitcher.ViewModels"
    xmlns:converters="clr-namespace:FlipSwitcher.Converters"
    mc:Ignorable="d"
    Title="{DynamicResource AppTitle}"
    Height="520"
    Width="640"
    WindowStyle="None"
    AllowsTransparency="True"
    Background="Transparent"
    WindowStartupLocation="CenterScreen"
    Topmost="True"
    ShowInTaskbar="False"
    ResizeMode="NoResize"
    Deactivated="Window_Deactivated"
    PreviewKeyDown="Window_PreviewKeyDown"
    Loaded="Window_Loaded">

    <Window.DataContext>
        <vm:MainViewModel />
    </Window.DataContext>

    <Window.Resources>
        <converters:ElevatedToOpacityConverter x:Key="ElevatedToOpacityConverter" />
        <converters:ElevatedToVisibilityConverter x:Key="ElevatedToVisibilityConverter" />
    </Window.Resources>

    <!-- Main Container with Acrylic-like background -->
    <Border x:Name="MainBorder"
        Background="{DynamicResource BackgroundAcrylicBaseBrush}"
        BorderBrush="{DynamicResource SurfaceStrokeBrush}"
        BorderThickness="1"
        CornerRadius="12">

        <Grid Margin="0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- Title Bar / Header -->
            <Border Grid.Row="0"
                Background="{DynamicResource BackgroundSolidSecondaryBrush}"
                CornerRadius="12,12,0,0"
                Padding="20,16">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!-- App Icon and Title -->
                    <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                        <!-- Fluent Icon -->
                        <Border Width="32" Height="32"
                            Background="{DynamicResource AccentGradientBrush}"
                            CornerRadius="8"
                            Margin="0,0,12,0">
                            <Path
                                Data="M4 4H10V10H4V4ZM14 4H20V10H14V4ZM4 14H10V20H4V14ZM14 14H20V20H14V14Z"
                                Fill="White"
                                Stretch="Uniform"
                                Width="16" Height="16"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center" />
                        </Border>

                        <TextBlock Text="{DynamicResource AppTitle}"
                            Style="{DynamicResource TitleTextStyle}"
                            VerticalAlignment="Center" />
                    </StackPanel>

                    <!-- Window Count Badge -->
                    <Border Grid.Column="2"
                        Background="{DynamicResource AccentDefaultBrush}"
                        CornerRadius="12"
                        Padding="12,4"
                        VerticalAlignment="Center">
                        <TextBlock Style="{DynamicResource CaptionTextStyle}"
                            Foreground="{DynamicResource TextOnAccentBrush}">
                            <Run Text="{Binding WindowCount, Mode=OneWay}" />
                            <Run Text="{DynamicResource WindowsCount}" />
                        </TextBlock>
                    </Border>
                </Grid>
            </Border>

            <!-- Search Box -->
            <Border Grid.Row="1"
                Padding="16,12"
                Background="{DynamicResource BackgroundSolidBaseBrush}">
                <TextBox x:Name="SearchBox"
                    Style="{DynamicResource FluentSearchBoxStyle}"
                    Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                    VerticalAlignment="Center" />
            </Border>

            <!-- Window List -->
            <Border Grid.Row="2"
                Background="{DynamicResource BackgroundSolidBaseBrush}">
                <Grid>
                    <!-- Windows List -->
                    <ListBox x:Name="WindowList"
                        ItemsSource="{Binding FilteredWindows}"
                        SelectedItem="{Binding SelectedWindow, Mode=TwoWay}"
                        Style="{DynamicResource FluentListBoxStyle}"
                        Padding="8,4"
                        Visibility="{Binding HasWindows, Converter={StaticResource BoolToVisibilityConverter}}"
                        PreviewMouseLeftButtonUp="WindowList_PreviewMouseLeftButtonUp"
                        ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                        VirtualizingPanel.IsVirtualizing="True"
                        VirtualizingPanel.VirtualizationMode="Recycling">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Grid Margin="2,0" Opacity="{Binding IsElevated, Converter={StaticResource ElevatedToOpacityConverter}}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <!-- Window Icon -->
                                    <Border Grid.Column="0"
                                        Width="40" Height="40"
                                        Background="{DynamicResource ControlDefaultBrush}"
                                        CornerRadius="8"
                                        Margin="0,0,12,0">
                                        <Image Source="{Binding Icon}"
                                            Width="32" Height="32"
                                            RenderOptions.BitmapScalingMode="HighQuality"
                                            HorizontalAlignment="Center"
                                            VerticalAlignment="Center" />
                                    </Border>

                                    <!-- Window Info -->
                                    <StackPanel Grid.Column="1"
                                        VerticalAlignment="Center"
                                        HorizontalAlignment="Left">
                                        <TextBlock Text="{Binding FormattedTitle}"
                                            Style="{DynamicResource BodyStrongTextStyle}"
                                            TextTrimming="CharacterEllipsis"
                                            HorizontalAlignment="Left" />
                                        <TextBlock Text="{Binding ProcessName}"
                                            Style="{DynamicResource CaptionTextStyle}"
                                            HorizontalAlignment="Left"
                                            Margin="0,2,0,0" />
                                    </StackPanel>

                                    <!-- Elevated Indicator (Admin window when not running as admin) -->
                                    <Border Grid.Column="2"
                                        Visibility="{Binding IsElevated, Converter={StaticResource ElevatedToVisibilityConverter}}"
                                        Background="{DynamicResource SystemFillColorCautionBackgroundBrush}"
                                        CornerRadius="4"
                                        Padding="8,4"
                                        Margin="8,0,0,0"
                                        VerticalAlignment="Center">
                                        <TextBlock Text="{DynamicResource ElevatedWindow}"
                                            Style="{DynamicResource CaptionTextStyle}"
                                            Foreground="{DynamicResource SystemFillColorCautionBrush}" />
                                    </Border>

                                    <!-- Minimized Indicator -->
                                    <Border Grid.Column="3"
                                        Visibility="{Binding IsMinimized, Converter={StaticResource BoolToVisibilityConverter}}"
                                        Background="{DynamicResource ControlDefaultBrush}"
                                        CornerRadius="4"
                                        Padding="8,4"
                                        Margin="8,0,0,0"
                                        VerticalAlignment="Center">
                                        <TextBlock Text="{DynamicResource Minimized}"
                                            Style="{DynamicResource CaptionTextStyle}"
                                            Foreground="{DynamicResource TextTertiaryBrush}" />
                                    </Border>
                                </Grid>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>

                    <!-- Empty State -->
                    <StackPanel
                        Visibility="{Binding NoWindowsFound, Converter={StaticResource BoolToVisibilityConverter}}"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Margin="0,40">
                        <!-- Search Icon -->
                        <Border Width="64" Height="64"
                            Background="{DynamicResource ControlDefaultBrush}"
                            CornerRadius="32"
                            Margin="0,0,0,16">
                            <Path
                                Data="M10 0C4.48 0 0 4.48 0 10C0 15.52 4.48 20 10 20C12.4 20 14.6 19.13 16.32 17.68L23.32 24.68C23.71 25.07 24.34 25.07 24.73 24.68C25.12 24.29 25.12 23.66 24.73 23.27L17.73 16.27C19.13 14.55 20 12.35 20 10C20 4.48 15.52 0 10 0ZM10 18C5.59 18 2 14.41 2 10C2 5.59 5.59 2 10 2C14.41 2 18 5.59 18 10C18 14.41 14.41 18 10 18Z"
                                Fill="{DynamicResource TextTertiaryBrush}"
                                Stretch="Uniform"
                                Width="28" Height="28"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center" />
                        </Border>
                        <TextBlock Text="{DynamicResource NoWindowsFound}"
                            Style="{DynamicResource SubtitleTextStyle}"
                            Foreground="{DynamicResource TextSecondaryBrush}"
                            HorizontalAlignment="Center" />
                        <TextBlock Text="{DynamicResource TryDifferentSearch}"
                            Style="{DynamicResource CaptionTextStyle}"
                            HorizontalAlignment="Center"
                            Margin="0,4,0,0" />
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Footer / Keyboard Hints -->
            <Border Grid.Row="3"
                Background="{DynamicResource BackgroundSolidSecondaryBrush}"
                CornerRadius="0,0,12,12"
                Padding="16,10">
                <Grid>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Left">
                        <!-- Alt+S Search Hint -->
                        <Border Background="{DynamicResource ControlDefaultBrush}"
                            CornerRadius="4"
                            Padding="6,3"
                            Margin="0,0,4,0">
                            <TextBlock Text="Alt+S"
                                Style="{DynamicResource CaptionTextStyle}"
                                FontSize="11"
                                Foreground="{DynamicResource TextSecondaryBrush}" />
                        </Border>
                        <TextBlock Text="{DynamicResource HintSearch}"
                            Style="{DynamicResource CaptionTextStyle}"
                            FontSize="11"
                            VerticalAlignment="Center"
                            Margin="0,0,12,0" />

                        <!-- Alt+W Close Hint -->
                        <Border Background="{DynamicResource ControlDefaultBrush}"
                            CornerRadius="4"
                            Padding="6,3"
                            Margin="0,0,4,0">
                            <TextBlock Text="Alt+W"
                                Style="{DynamicResource CaptionTextStyle}"
                                FontSize="11"
                                Foreground="{DynamicResource TextSecondaryBrush}" />
                        </Border>
                        <TextBlock Text="{DynamicResource HintClose}"
                            Style="{DynamicResource CaptionTextStyle}"
                            FontSize="11"
                            VerticalAlignment="Center"
                            Margin="0,0,12,0" />

                        <!-- Alt+, Settings Hint -->
                        <Border Background="{DynamicResource ControlDefaultBrush}"
                            CornerRadius="4"
                            Padding="6,3"
                            Margin="0,0,4,0">
                            <TextBlock Text="Alt+,"
                                Style="{DynamicResource CaptionTextStyle}"
                                FontSize="11"
                                Foreground="{DynamicResource TextSecondaryBrush}" />
                        </Border>
                        <TextBlock Text="{DynamicResource HintSettings}"
                            Style="{DynamicResource CaptionTextStyle}"
                            FontSize="11"
                            VerticalAlignment="Center"
                            Margin="0,0,12,0" />

                        <!-- Alt+D Exit Hint -->
                        <Border Background="{DynamicResource ControlDefaultBrush}"
                            CornerRadius="4"
                            Padding="6,3"
                            Margin="0,0,4,0">
                            <TextBlock Text="Alt+D"
                                Style="{DynamicResource CaptionTextStyle}"
                                FontSize="11"
                                Foreground="{DynamicResource TextSecondaryBrush}" />
                        </Border>
                        <TextBlock Text="{DynamicResource HintExit}"
                            Style="{DynamicResource CaptionTextStyle}"
                            FontSize="11"
                            VerticalAlignment="Center"
                            Margin="0,0,12,0" />
                    </StackPanel>

                    <!-- Hotkey Reminder -->
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <Border Background="{DynamicResource AccentDefaultBrush}"
                            CornerRadius="4"
                            Padding="8,4">
                            <TextBlock x:Name="HotkeyDisplayText"
                                Text="Alt + Space"
                                Style="{DynamicResource CaptionTextStyle}"
                                FontSize="11"
                                Foreground="{DynamicResource TextOnAccentBrush}" />
                        </Border>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>
    </Border>
</Window>